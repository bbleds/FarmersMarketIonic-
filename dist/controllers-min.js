angular.module("starter.controllers",[]).controller("DashCtrl",function(e,t,n,o){function a(e,t){var a=[];n(function(e,n){o.get("http://search.ams.usda.gov/farmersmarkets/v1/data.svc/mktDetail?id="+t).success(function(t){e(t)},function(e){n(e)})}).then(function(t){marketName=e;var n=parseFloat(t.marketdetails.GoogleLink.split("?q=")[1].split("%2C%20")[0]),o=parseFloat(t.marketdetails.GoogleLink.split("?q=")[1].split("%2C%20")[1].split("%20")[0]),s={address:t.marketdetails.Address,products:t.marketdetails.Products,schedule:t.marketdetails.Schedule,lat:n,lng:o,marketname:e};a.push(s);var r=new google.maps.Marker({position:{lat:s.lat,lng:s.lng},map:i,title:"Hello World!",animation:google.maps.Animation.DROP});c.push(r);var l={content:"<h3>"+s.marketname+"</h3><br<<p>"+s.address+"</p><br<<p>"+s.schedule+"</p>"},p=new google.maps.InfoWindow(l);google.maps.event.addListener(r,"click",function(e){p.open(i,r)})})}function s(t){for(var n=t.results,o=[],s=[],i=0;5>i;i++)s.push(n[i].id),o.push(n[i].marketname);for(var i=0;i<s.length;i++){var r=o[i].split(" ").splice(1).join(" ");a(r,s[i])}e.mapLoaded=!0}var i,r,l;e.mapLoaded=!1;var c=[],p={timeout:1e4,enableHighAccuracy:!1};t.getCurrentPosition(p).then(function(e){r=e.coords.latitude,l=e.coords.longitude;var t={center:new google.maps.LatLng(r,l),zoom:10,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1};i=new google.maps.Map(document.getElementById("map"),t);var a=new google.maps.Marker({position:{lat:r,lng:l},map:i,title:"ME",icon:"../img/iphone2.png",animation:google.maps.Animation.DROP}),c={content:"You Are Here!"},p=new google.maps.InfoWindow(c);google.maps.event.addListener(a,"click",function(e){p.open(i,a)}),n(function(e,t){o.get("http://maps.googleapis.com/maps/api/geocode/json?latlng="+r+","+l).success(function(t){e(t)},function(e){t(addressResponse)})}).then(function(e){var t=e.results[2].address_components[0].long_name;n(function(e,n){o.get("http://search.ams.usda.gov/farmersmarkets/v1/data.svc/zipSearch?zip="+t).success(function(t){e(t)},function(e){n(e)})}).then(function(e){s(e)})})}),e.zipEnter=function(e,t){var a=e.keyCode,r=/[0-9]/g;if(13===a&&5===t.match(r).length){for(var l=0;l<c.length;l++)c[l].setMap(null);n(function(e,n){o.get("http://maps.googleapis.com/maps/api/geocode/json?address="+t+"&country=us").success(function(t){e(t)},function(e){n(e)})}).then(function(e){var t=e.results[0].geometry.location.lat,n=e.results[0].geometry.location.lng,o={lat:t,lng:n};i.panTo(o)}),n(function(e,n){o.get("http://search.ams.usda.gov/farmersmarkets/v1/data.svc/zipSearch?zip="+t).success(function(t){e(t)},function(e){n(e)})}).then(function(e){s(e)})}}});